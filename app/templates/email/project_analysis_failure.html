<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="x-apple-disable-message-reformatting">
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Failure — {{ job_type }}</title>
    <style>
      .chip { display:inline-block; padding:2px 8px; border-radius:999px; font-size:12px; line-height:18px; background:#111827; color:#e5e7eb; border:1px solid #374151; }
      .code { font-family: ui-monospace,SFMono-Regular,Menlo,Consolas,monospace; background:#0b1220; color:#e5e7eb; border:1px solid #1f2937; border-radius:6px; padding:2px 6px; }
      .muted { color:#9ca3af; }
      .k { width:180px; color:#9ca3af; vertical-align:top; padding:6px 0; }
      .v { color:#e5e7eb; padding:6px 0; }
      .section-title { margin:18px 0 8px 0; font-size:14px; font-weight:700; color:#e5e7eb; }
    </style>
  </head>
  <body style="margin:0;background:#0b1220;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:#e5e7eb;">
    <table role="presentation" width="100%" cellspacing="0" cellpadding="0" style="padding:24px 0;">
      <tr>
        <td align="center">
          <table role="presentation" width="880" cellspacing="0" cellpadding="0" style="background:#111827;border-radius:12px;box-shadow:0 2px 10px rgba(0,0,0,.35);overflow:hidden;border:1px solid #1f2937;">
            <!-- Header -->
            <tr>
              <td style="padding:18px 22px;border-bottom:1px solid #1f2937;">
                <div style="font-size:18px;font-weight:800;letter-spacing:.2px;">
                  ❌ Failure — <span class="chip">{{ job_type }}</span>
                </div>
                {% if error_summary %}
                <div style="margin-top:8px;color:#fca5a5;font-weight:600;">{{ error_summary }}</div>
                {% endif %}
                {% if error_type %}
                <div style="margin-top:6px;color:#9ca3af;font-size:12px;">{{ error_type }}</div>
                {% endif %}
              </td>
            </tr>

            <!-- Facts -->
            <tr>
              <td style="padding:16px 22px;">
                <table role="presentation" width="100%" cellspacing="0" cellpadding="0" style="font-size:13px;">
                  <tr>
                    <td class="k">Repository</td>
                    <td class="v">
                      {% if repository_html_url %}
                        <a href="{{ repository_html_url }}" style="color:#60a5fa;text-decoration:none;">{{ repository_html_url }}</a>
                      {% else %}
                        <span class="muted">—</span>
                      {% endif %}
                      &nbsp;•&nbsp; repo_id <span class="code">{{ repo_id }}</span>
                    </td>
                  </tr>
                  <tr>
                    <td class="k">Branch</td>
                    <td class="v">
                      {% if repository_branch %}
                        <span class="code">{{ repository_branch }}</span>
                      {% else %}
                        <span class="muted">—</span>
                      {% endif %}
                    </td>
                  </tr>
                  <tr>
                    <td class="k">User</td>
                    <td class="v">
                      {% if user_email %}
                        <a href="mailto:{{ user_email }}" style="color:#60a5fa;text-decoration:none;">{{ user_email }}</a>
                      {% else %}
                        <span class="muted">—</span>
                      {% endif %}
                      &nbsp;•&nbsp; user_id <span class="code">{{ user_id }}</span>
                    </td>
                  </tr>
                  <tr>
                    <td class="k">Context ID</td>
                    <td class="v">
                      {% if job_context_id %}
                        <span class="code">{{ job_context_id }}</span>
                      {% else %}
                        <span class="muted">—</span>
                      {% endif %}
                    </td>
                  </tr>
                </table>
              </td>
            </tr>

            <!-- Timing -->
            <tr>
              <td style="padding:0 22px 10px 22px;">
                <div class="section-title">Timing</div>
                <table role="presentation" width="100%" cellspacing="0" cellpadding="0" style="font-size:13px;">
                  <tr>
                    <td class="k">Queued at</td>
                    <td class="v">{% if job_queued_at %}{{ job_queued_at }}{% else %}<span class="muted">—</span>{% endif %}</td>
                  </tr>
                  <tr>
                    <td class="k">Started at</td>
                    <td class="v">{% if job_started_at %}{{ job_started_at }}{% else %}<span class="muted">—</span>{% endif %}</td>
                  </tr>
                  <tr>
                    <td class="k">Finished at</td>
                    <td class="v">{% if job_finished_at %}{{ job_finished_at }}{% else %}<span class="muted">—</span>{% endif %}</td>
                  </tr>
                  <tr>
                    <td class="k">Settled at</td>
                    <td class="v">
                      {% if job_settled_at %}{{ job_settled_at }}{% else %}<span class="muted">—</span>{% endif %}
                      <span class="muted"> (includes post-operation)</span>
                    </td>
                  </tr>
                  <tr>
                    <td class="k">Run (core)</td>
                    <td class="v">
                      {% if run_ms %}<span class="code">{{ run_ms }}</span> <span class="muted">ms</span>{% else %}<span class="muted">—</span>{% endif %}
                    </td>
                  </tr>
                  <tr>
                    <td class="k">Total (queue→settled)</td>
                    <td class="v">
                      {% if total_ms %}<span class="code">{{ total_ms }}</span> <span class="muted">ms</span>{% else %}<span class="muted">—</span>{% endif %}
                    </td>
                  </tr>
                </table>
              </td>
            </tr>

            <!-- Stacktrace -->
            <tr>
              <td style="padding:4px 22px 18px 22px;">
                <div class="section-title">
                  Stack trace
                  {% if error_stacktrace_truncated %}<span class="chip" style="margin-left:8px;background:#7f1d1d;border-color:#991b1b;">TRUNCATED</span>{% endif %}
                </div>
                {% if error_stacktrace %}
                  <pre style="background:#0b1220;border:1px solid #1f2937;color:#e5e7eb;padding:12px;border-radius:8px;white-space:pre-wrap;word-break:break-word;max-height:520px;overflow:auto;margin:0;">{{ error_stacktrace }}</pre>
                {% else %}
                  <div class="muted">—</div>
                {% endif %}
              </td>
            </tr>

            <!-- Footer -->
            <tr>
              <td style="padding:12px 22px;border-top:1px solid #1f2937;color:#9ca3af;font-size:12px;">
                DevDox
              </td>
            </tr>
          </table>
        </td>
      </tr>
    </table>
  </body>
</html>
